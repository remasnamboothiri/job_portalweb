{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Results - {{ interview.candidate_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .results-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .score-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
            border-left: 5px solid #667eea;
        }
        
        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            margin: 0 auto 1rem;
        }
        
        .score-excellent { background: #28a745; }
        .score-good { background: #17a2b8; }
        .score-average { background: #ffc107; color: #333; }
        .score-poor { background: #dc3545; }
        
        .recommendation-badge {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        
        .recommendation-highly_recommended {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .recommendation-recommended {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .recommendation-maybe {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .recommendation-not_recommended {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .qa-section {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .question {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
        }
        
        .answer {
            background: #e8f4fd;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #17a2b8;
        }
        
        .interview-meta {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #5a6268;
            color: white;
            text-decoration: none;
        }
        
        .print-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .print-btn:hover {
            background: #218838;
        }
        
        @media print {
            .no-print { display: none !important; }
            .results-header { background: #667eea !important; }
        }
    </style>
</head>
<body>
    <div class="results-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-chart-line me-3"></i>Interview Results</h1>
                    <p class="mb-0 fs-5">{{ interview.candidate_name }} - {{ interview.job.title }}</p>
                </div>
                <div class="col-md-4 text-end no-print">
                    <a href="{% url 'recruiter_dashboard' %}" class="back-btn me-2">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                    <button onclick="window.print()" class="print-btn">
                        <i class="fas fa-print"></i> Print Results
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Interview Metadata -->
        <div class="interview-meta">
            <div class="row">
                <div class="col-md-3">
                    <strong>Candidate:</strong><br>
                    {{ interview.candidate_name }}
                </div>
                <div class="col-md-3">
                    <strong>Position:</strong><br>
                    <a href="{% url 'job_detail' interview.job.id %}" 
                        style="color: #667eea; text-decoration: none; font-weight: 500;"
                        onmouseover="this.style.textDecoration='underline'"
                        onmouseout="this.style.textDecoration='none'">
                        {{ interview.job.title }}
                    </a>
                </div>
                {% comment %} <div class="col-md-3">
                    <strong>Position:</strong><br>
                   
                    {{ interview.job.title }}
                </div> {% endcomment %}
                <div class="col-md-3">
                    <strong>Company:</strong><br>
                    {{ interview.job.company }}
                </div>
                <div class="col-md-3">
                    <strong>Interview Date:</strong><br>
                    {{ interview.completed_at|date:"M d, Y" }}
                    {% if interview_duration %}
                        <br><small class="text-muted">Duration: {{ interview_duration }}</small>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Scores Section -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="score-card text-center">
                    <div class="score-circle {% if interview.overall_score >= 8 %}score-excellent{% elif interview.overall_score >= 6 %}score-good{% elif interview.overall_score >= 4 %}score-average{% else %}score-poor{% endif %}">
                        {{ interview.overall_score|floatformat:1 }}/10
                    </div>
                    <h6>Overall Score</h6>
                </div>
            </div>
            <div class="col-md-3">
                <div class="score-card text-center">
                    <div class="score-circle {% if interview.technical_score >= 8 %}score-excellent{% elif interview.technical_score >= 6 %}score-good{% elif interview.technical_score >= 4 %}score-average{% else %}score-poor{% endif %}">
                        {{ interview.technical_score|floatformat:1 }}/10
                    </div>
                    <h6>Technical Skills</h6>
                </div>
            </div>
            <div class="col-md-3">
                <div class="score-card text-center">
                    <div class="score-circle {% if interview.communication_score >= 8 %}score-excellent{% elif interview.communication_score >= 6 %}score-good{% elif interview.communication_score >= 4 %}score-average{% else %}score-poor{% endif %}">
                        {{ interview.communication_score|floatformat:1 }}/10
                    </div>
                    <h6>Communication</h6>
                </div>
            </div>
            <div class="col-md-3">
                <div class="score-card text-center">
                    <div class="score-circle {% if interview.problem_solving_score >= 8 %}score-excellent{% elif interview.problem_solving_score >= 6 %}score-good{% elif interview.problem_solving_score >= 4 %}score-average{% else %}score-poor{% endif %}">
                        {{ interview.problem_solving_score|floatformat:1 }}/10
                    </div>
                    <h6>Problem Solving</h6>
                </div>
            </div>
        </div>

        <!-- Recommendation -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="score-card">
                    <h5><i class="fas fa-thumbs-up me-2"></i>Recommendation</h5>
                    <span class="recommendation-badge recommendation-{{ interview.recommendation }}">
                        {% if interview.recommendation == 'highly_recommended' %}
                            Highly Recommended
                        {% elif interview.recommendation == 'recommended' %}
                            Recommended
                        {% elif interview.recommendation == 'maybe' %}
                            Maybe
                        {% else %}
                            Not Recommended
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>

        <!-- AI Feedback -->
        {% if interview.ai_feedback %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="score-card">
                    <h5><i class="fas fa-robot me-2"></i>AI Analysis</h5>
                    <p class="mb-0">{{ interview.ai_feedback }}</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Interview Statistics -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="score-card text-center">
                    <h3 class="text-primary">{{ total_questions }}</h3>
                    <p class="mb-0">Questions Asked</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="score-card text-center">
                    <h3 class="text-success">{{ total_answers }}</h3>
                    <p class="mb-0">Responses Given</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="score-card text-center">
                    <h3 class="text-info">
                        {% if total_questions > 0 %}
                            {{ total_answers|floatformat:0 }}/{{ total_questions }}
                        {% else %}
                            0/0
                        {% endif %}
                    </h3>
                    <p class="mb-0">Response Rate</p>
                </div>
            </div>
        </div>

        <!-- Questions and Answers -->
        <div class="row">
            <div class="col-12">
                <h4 class="mb-3"><i class="fas fa-comments me-2"></i>Interview Conversation</h4>
                
                {% if qa_pairs %}
                    {% for qa in qa_pairs %}
                    <div class="qa-section">
                        <h6 class="text-muted mb-3">Question {{ qa.question_number }}</h6>
                        
                        <div class="question">
                            <strong><i class="fas fa-user-tie me-2"></i>Interviewer:</strong>
                            <p class="mb-0 mt-2">{{ qa.question }}</p>
                        </div>
                        
                        <div class="answer">
                            <strong><i class="fas fa-user me-2"></i>{{ interview.candidate_name }}:</strong>
                            <p class="mb-0 mt-2">{{ qa.answer }}</p>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="qa-section text-center">
                        <i class="fas fa-exclamation-triangle text-warning fs-1 mb-3"></i>
                        <h5>No conversation data available</h5>
                        <p class="text-muted">The interview conversation could not be retrieved. This might be due to a technical issue during the interview.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Full Transcript -->
        {% if interview.transcript %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="score-card">
                    <h5><i class="fas fa-file-alt me-2"></i>Full Transcript</h5>
                    <div style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 1rem; border-radius: 5px;">
                        <pre style="white-space: pre-wrap; font-family: inherit;">{{ interview.transcript }}</pre>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>