{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Schedule Interview</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/interview.css' %}">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">Schedule Interview</h2>
                </div>
                <div class="card-body">
                    {% if job %}
                        <div class="alert alert-info">
                            <h5>Job Details</h5>
                            <p class="mb-1"><strong>Position:</strong> {{ job.title }}</p>
                            <p class="mb-1"><strong>Company:</strong> {{ job.company }}</p>
                            <p class="mb-0"><strong>Location:</strong> {{ job.location }}</p>
                        </div>
                    {% endif %}
                    
                    <p class="text-muted">Schedule an interview for any candidate - they don't need to be registered on the platform.</p>

                    <form method="post" id="interviewForm">
                        {% csrf_token %}
                        
                        <!-- Display form errors -->
                        {% if form.errors %}
                            <div class="alert alert-danger">
                                <strong>Please fix the following errors:</strong>
                                <ul class="mb-0">
                                    {% for field in form %}
                                        {% for error in field.errors %}
                                            <li>{{ field.label }}: {{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                    {% for error in form.non_field_errors %}
                                        <li>{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        
                        <!-- Job Position -->
                        <div class="mb-3">
                            {{ form.job.label_tag }}
                            {{ form.job }}
                        </div>
                        
                        <!-- Candidate Type Selection -->
                        <div class="mb-4">
                            <label class="form-label">Candidate Type</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="candidate_type" id="unregistered" value="unregistered" checked>
                                <label class="form-check-label" for="unregistered">
                                    <strong>New/Unregistered Candidate</strong>
                                    <small class="text-muted d-block">Enter candidate details manually</small>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="candidate_type" id="registered" value="registered">
                                <label class="form-check-label" for="registered">
                                    <strong>Existing Registered User</strong>
                                    <small class="text-muted d-block">Select from registered candidates</small>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Existing Candidate Selection (hidden by default) -->
                        <div class="mb-3" id="existing_candidate_field" style="display: none;">
                            {{ form.existing_candidate.label_tag }}
                            {{ form.existing_candidate }}
                            <small class="form-text text-muted">{{ form.existing_candidate.help_text }}</small>
                        </div>
                        
                        <!-- Manual Candidate Fields -->
                        <div id="manual_candidate_fields">
                            <div class="mb-3">
                                {{ form.candidate_name.label_tag }}
                                {{ form.candidate_name }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form.candidate_email.label_tag }}
                                {{ form.candidate_email }}
                            </div>
                            
                            <div class="mb-3">
                                {{ form.candidate_phone.label_tag }}
                                {{ form.candidate_phone }}
                            </div>
                        </div>
                        
                        <!-- Interview Date & Time -->
                        <div class="mb-3">
                            {{ form.scheduled_at.label_tag }}
                            {{ form.scheduled_at }}
                        </div>
                        
                        <!-- Interview Link (Optional) -->
                        <div class="mb-3">
                            {{ form.link.label_tag }}
                            {{ form.link }}
                            <small class="form-text text-muted">Optional: Leave empty to use our built-in interview system</small>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-calendar-plus"></i> Schedule Interview & Send Email
                            </button>
                            <a href="{% url 'recruiter_dashboard' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Dashboard
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const unregisteredRadio = document.getElementById('unregistered');
    const registeredRadio = document.getElementById('registered');
    const existingCandidateField = document.getElementById('existing_candidate_field');
    const manualCandidateFields = document.getElementById('manual_candidate_fields');
    const existingCandidateSelect = document.querySelector('select[name="existing_candidate"]');
    const candidateNameInput = document.querySelector('input[name="candidate_name"]');
    const candidateEmailInput = document.querySelector('input[name="candidate_email"]');
    
    function toggleCandidateFields() {
        if (registeredRadio.checked) {
            existingCandidateField.style.display = 'block';
            manualCandidateFields.style.display = 'none';
            
            // Clear manual fields and make them not required
            candidateNameInput.removeAttribute('required');
            candidateEmailInput.removeAttribute('required');
            candidateNameInput.value = '';
            candidateEmailInput.value = '';
            
            // Make existing candidate required
            existingCandidateSelect.setAttribute('required', 'required');
        } else {
            existingCandidateField.style.display = 'none';
            manualCandidateFields.style.display = 'block';
            
            // Clear existing candidate field
            existingCandidateSelect.removeAttribute('required');
            existingCandidateSelect.selectedIndex = 0;
            
            // Make manual fields required
            candidateNameInput.setAttribute('required', 'required');
            candidateEmailInput.setAttribute('required', 'required');
        }
    }
    
    // Auto-fill candidate details when existing candidate is selected
    existingCandidateSelect.addEventListener('change', function() {
        if (this.value) {
            const selectedOption = this.options[this.selectedIndex];
            const candidateData = selectedOption.text.split(' - '); // Assuming format: "Name - email"
            
            // You might need to fetch candidate details via AJAX
            // For now, we'll just show the selection is working
            console.log('Selected candidate:', selectedOption.text);
        }
    });
    
    unregisteredRadio.addEventListener('change', toggleCandidateFields);
    registeredRadio.addEventListener('change', toggleCandidateFields);
    
    // Initialize on page load
    toggleCandidateFields();
});
</script>
</body>
</html>